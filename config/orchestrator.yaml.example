# ProxCenter Orchestrator Configuration (Docker)
# This file is auto-generated by install.sh
# Copy to orchestrator.yaml and customize as needed

api:
  address: ":8080"
  read_timeout: 30s
  write_timeout: 30s
  cors_origins:
    - "http://localhost:3000"
    - "http://proxcenter:3000"
  api_key: ""  # Optional: API key for external access

database:
  driver: sqlite
  dsn: "file:/app/data/orchestrator.db?cache=shared&mode=rwc"

proxmox:
  # Path to ProxCenter frontend database (Docker volume mount)
  proxcenter_db_path: "/app/shared_data/proxcenter.db"

  # IMPORTANT: Must match APP_SECRET from .env
  # This is auto-generated by install.sh
  app_secret: "YOUR_APP_SECRET_HERE"

  request_timeout: 30s
  max_retries: 3

drs:
  enabled: true
  mode: manual  # manual, automatic

  # Resource thresholds
  cpu_high_threshold: 70
  cpu_low_threshold: 20
  memory_high_threshold: 75
  memory_low_threshold: 25
  storage_high_threshold: 90

  # Balancing configuration
  balancing_method: memory  # cpu, memory, combined
  balancing_mode: used      # used, allocated
  balance_types:
    - vm
  balance_larger_first: false

  # Imbalance threshold for proactive mode
  imbalance_threshold: 4.0

  # Homogenization (active balancing)
  homogenization_enabled: true
  max_load_spread: 5.0
  target_tolerance: 3.0
  min_spread_reduction: 1.0

  # Weights (higher = more important)
  cpu_weight: 0.3
  memory_weight: 1.5
  storage_weight: 0.0

  # Migration constraints
  max_concurrent_migrations: 2
  migration_cooldown: 5m
  min_vm_uptime_for_migration: 10m
  enable_affinity_rules: true
  enforce_affinity: false
  prevent_overprovisioning: true

notifications:
  enable_alerts: true
  enable_backups: true
  enable_maintenance: true
  enable_migrations: true
  enable_reports: true
  min_severity: info
  rate_limit_per_hour: 100

  email:
    enabled: false
    smtp_host: "smtp.example.com"
    smtp_port: 587
    smtp_user: "your-smtp-user"
    smtp_password: "your-smtp-password"
    smtp_from: "proxcenter@yourdomain.com"
    smtp_from_name: "ProxCenter"
    use_tls: false
    use_starttls: true
    skip_verify: false
    default_recipients:
      - "admin@yourdomain.com"

scheduler:
  metrics_interval: 1m
  drs_interval: 60m
  rebalance_interval: 1440m
  event_poll_interval: 30s
